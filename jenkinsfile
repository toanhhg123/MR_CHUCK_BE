pipeline {
    agent any

    

    stages {
       stage('Run Docker Compose') {
            steps {
                script {
                    // Create a .env file with the environment variables
                    writeFile file: '.env', text: """
                        DATABASE_URL=${env.DATABASE_URL}
                        CLOUDINARY_CLOUD_NAME=${env.CLOUDINARY_CLOUD_NAME}
                        CLOUDINARY_API_KEY=${env.CLOUDINARY_API_KEY}
                        CLOUDINARY_API_SECRET=${env.CLOUDINARY_API_SECRET}
                        CLOUDINARY_FOLDER_NAME=${env.CLOUDINARY_FOLDER_NAME}
                        SECRET_JWT=${env.SECRET_JWT}
                    """

                    // Run Docker Compose
                    sh 'docker compose up -d'
                }
            }
        }

        
    }

     post {
          always {
              // Clean up: stop and remove containers
              script {
                  sh 'docker-compose down'
              }
          }
    }
}
