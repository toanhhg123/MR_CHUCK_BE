pipeline {
    agent any

    environment {
    	DATABASE_URL = credentials('DATABASE_URL')
      CLOUDINARY_CLOUD_NAME = credentials('CLOUDINARY_CLOUD_NAME')
      CLOUDINARY_API_KEY = credentials('CLOUDINARY_API_KEY')
      CLOUDINARY_API_SECRET = credentials('CLOUDINARY_API_SECRET')
      CLOUDINARY_FOLDER_NAME = credentials('CLOUDINARY_FOLDER_NAME')
      SECRET_JWT = credentials('SECRET_JWT')
    }

    stages {
       stage('Run Docker Compose') {
            steps {
                script {
                    // Create a .env file with the environment variables
                    writeFile file: '.env', text: """
                        DATABASE_URL=${DATABASE_URL}
                        CLOUDINARY_CLOUD_NAME=${CLOUDINARY_CLOUD_NAME}
                        CLOUDINARY_API_KEY=${CLOUDINARY_API_KEY}
                        CLOUDINARY_API_SECRET=${CLOUDINARY_API_SECRET}
                        CLOUDINARY_FOLDER_NAME=${CLOUDINARY_FOLDER_NAME}
                        SECRET_JWT=${SECRET_JWT}
                    """

                    // Run Docker Compose
                    sh 'docker-compose up -d'
                }
            }
        }

        
    }

     post {
          always {
              // Clean up: stop and remove containers
              script {
                  sh 'docker-compose down'
              }
          }
    }
}
